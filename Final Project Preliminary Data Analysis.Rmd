---
title: "ENGRD 302W New Data"
author: "Veronica"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
library(ggplot2)
library(tidyverse)
library(ggthemes)
library(dplyr)
library(maps)
library(ggmap)
library(plotly)
library(stringr)
library(lubridate)
#Importing the packages

```

```{r}
#load the csv files
GAED <- read.csv("C:/Users/13015/Documents/Fall 2023/ENGRD 302W/GAED.csv")
GA_counties <- read.csv("C:/Users/13015/Documents/Fall 2023/ENGRD 302W/GA_counties.csv")
GAED
GA_counties

#standardize the data
GA_counties$county_code <- as.character(GA_counties$county_code)

GA_counties$county_name <- tolower(GA_counties$county_name)

GAED_new <- GAED %>%
  mutate(county_code = gsub("g", "", geocode)) %>%
  select(-geocode)

GAED_new$county_code <- 
  as.character(GAED_new$county_code)
GAED_new

```

```{r}
#create the final base data frame
GAED_df <- left_join(GAED_new, GA_counties, by = c("county_code" = "county_code"))

GAED_df <- GAED_df %>%
  select(-sector, -varname) %>%
  rename("date" = "ldate")

#this dataset only includes data from
GAED_df$date <- as.Date(GAED_df$date, "%m/%d/%Y")
GAED_df$year <- year(ymd(GAED_df$date))
GAED_df$month <- month(ymd(GAED_df$date)) 
GAED_df$day <- day(ymd(GAED_df$date))

GA_emission_df <- GAED_df %>%
  select(-date) %>%
  rename("emission_value" = "datavalue") %>%
  filter(year %in% c("2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023"))
GA_emission_df

GA_emission_df$county_name <- replace(GA_emission_df$county_name, GA_emission_df$county_name=="de kalb", "dekalb")


```

```{r}
states<-map_data("state")

state_df <- map_data("state")%>%
    filter(region == "georgia")
county_df <- map_data("county") %>%
    filter(region == "georgia")

GA_population<-read.csv("C:/Users/13015/Documents/Fall 2023/ENGRD 302W/GA_population.csv")

GA_population_df <- GA_population %>%
  select(-X) %>%
  rename("county_name" = "County")

GA_population_df$county_name <- tolower(GA_population_df$county_name)
GA_population_df


```

```{r}
#this addresses an error in the county data frame
county_df$subregion <- replace(county_df$subregion, county_df$subregion=="de kalb", "dekalb")


population_map_data <- left_join(GA_population_df, county_df, by = c("county_name"="subregion"))
population_map_data

```

```{r}

ggplot(population_map_data, aes(x=long, y=lat)) +
        geom_polygon(aes(group=group, fill = Population), color="yellow") + 
        scale_fill_gradient(low="orange", high="red", trans = "log10") + 
        geom_polygon(data = state_df, aes(group=group), color = "black", fill = NA) + 
        theme_void()+ coord_quickmap()

```

```{r}
#visualization over a decade
GA_emission_2013 <- GA_emission_df %>%
  filter(year %in% c("2013"))
GA_emission_2013

GA_emission_2023 <- GA_emission_df %>%
  filter(year %in% c("2023"))
GA_emission_2023

```

```{r}
#creating a graphic showing emissions in Georgia over time
ggplot(data = GA_emission_df,aes(x = year, y = emission_value, color = county_name))+
    geom_point()+
    geom_line(aes(group = county_name))+
    labs(x="Year",y="Emission Pollution (metric tons)",title="Emission Pollution in the State of Georgia Over Time")+
    theme_bw()+
    theme(legend.position = "none")

#new data set hoe
GA_emission_df_new <-  GA_emission_df %>%
  select(emission_value, county_name, year) %>%
  group_by(year, county_name) %>%
  mutate(avg_emission = mean(emission_value)) %>%
  select(-emission_value) %>%
  distinct()
GA_emission_df_new

unique(GA_emission_df_new$avg_emission)

GA_emission_over_time <- ggplot(data = GA_emission_df_new,aes(x = year, y = avg_emission, color = county_name))+
    geom_point()+
    geom_line(aes(group = county_name))+
    labs(x="Year",y="Emission Pollution (metric tons)",title="Emission Pollution in the State of Georgia Over Time")+
    theme_bw() +
    theme(legend.position = "none")

ggsave("GA_emission_over_time_plot.png", GA_emission_over_time, height = 8)


```

```{r}
top_n_GA_emission <- GA_emission_df %>%
  group_by(county_name) %>%
  summarize(mean(emission_value)) %>%
  rename("avg_emission_value" = "mean(emission_value)") %>%
  top_n(n = 10, wt = avg_emission_value)
top_n_GA_emission

top_10_GA_emission <- GA_emission_df %>%
  filter(county_name %in% c("chartham", "clayton", "cobb", "dekalb", "forsyth", "fulton", "gwinnett", "hall", "henry", "richmond"))
top_10_GA_emission

ggplot(data = top_10_GA_emission,aes(x = year, y = emission_value, color = county_name))+
    geom_point()+
    geom_line(aes(group = county_name))+
    labs(x="Year",y="Emission Pollution (metric tons)",title="Emission Pollution in the State of Georgia Over Time")+
    theme_bw()+
    theme(legend.position = "none")

```

```{r}
avg_GA_emission <- GA_emission_df %>%
  group_by(county_name) %>%
  summarize(mean(emission_value)) %>%
  rename("avg_emission_value" = "mean(emission_value)")
avg_GA_emission

emission_map_data <- left_join(GA_population_df, county_df, by = c("county_name"="subregion"))
population_map_data


appling <- GA_emission_df %>%
  filter(county_name %in% c("appling"))
appling


ggplot(data = appling,aes(x = year, y = emission_value, color = county_name))+
    geom_point()+
    geom_line(aes(group = county_name))+
    labs(x="Year",y="Emission Pollution (metric tons)",title="Emission Pollution in the State of Georgia Over Time")+
    theme_bw()+
    theme(legend.position = "none")

```
